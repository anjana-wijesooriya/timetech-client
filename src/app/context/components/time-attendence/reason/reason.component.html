<div class="grid grid-cols-12 gap-4 support-wrapper">

    <div class="flex p-2 mb-4 col-span-12 bg-surface-50 dark:bg-surface-950 justify-center">
        <p-confirmDialog></p-confirmDialog>
        <p-toast></p-toast>
        <div class="w-full p-4 m-0 card bg-surface-0 dark:bg-surface-900 page-content-wrapper animate-zoomindown animate-duration-400 ">
            <div class="flex w-full pb-4 mb-4 card-header border-b border-surface justify-between">
                <div class="flex flex-wrap gap-4 items-center">
                    <!-- <p-avatar styleClass="flex items-center justify-center mr-2" size="xlarge">

                    </p-avatar> -->
                    <h5 class="m-0">Reasons</h5>
                </div>

            </div>
            <div class="flex w-full">
                <p-table #supportTable [rowHover]="true" [value]="tableEntries" [scrollable]="true"
                    scrollHeight="calc(100vh - 25rem)" [rows]="25" [showCurrentPageReport]="true"
                    [rowsPerPageOptions]="[25, 50, 100]" [loading]="isLoading" dataKey="code"
                    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                    [globalFilterFields]="['reasonName', 'compId']" [paginator]="true"
                    styleClass="p-datatable-gridlines p-datatable-sm" tableStyleClass="table-layout-fixed"
                    [resizableColumns]="true" columnResizeMode="fit" [autoLayout]="true" class="rounded-border"
                    responsive="true">
                    <ng-template pTemplate="caption">
                        <div class="flex flex-wrap justify-between">
                            <div class="flex flex-row gap-2 items-center justify-start">
                                <span class="p-float-label">
                                    <p-dropdown [options]="companies" [showClear]="false"
                                        placeholder="Filter by Company"
                                        (onChange)="supportTable.filterGlobal($event.value.compId, 'equals')"
                                        [(ngModel)]="selectedCompany">
                                        <ng-template let-selectedValue pTemplate="selectedItem">
                                            <div class="flex gap-2 items-center" *ngIf="selectedValue">
                                                <img src="assets/context/images/flag/flag_placeholder.png"
                                                    [class]="'flag flag-' + selectedValue.logo" style="width: 21px" />
                                                <div>{{ selectedValue.name }}</div>
                                            </div>
                                        </ng-template>
                                        <ng-template let-company pTemplate="item">
                                            <div class="flex gap-2 items-center">
                                                <img src="assets/context/images/flag/flag_placeholder.png"
                                                    [class]="'flag flag-' + company.logo" style="width: 21px" />
                                                <div>{{ company.name }}</div>
                                            </div>
                                        </ng-template>
                                    </p-dropdown>
                                    <label for="">Company</label>
                                </span>
                                <div class="flex flex-wrap">
                                    <p-iconField iconPosition="left">
                                        <p-inputIcon styleClass="pi pi-search" />
                                        <span class="p-float-label">
                                            <input type="text" pInputText placeholder="Search by Name" #filter
                                                (input)="supportTable.filterGlobal($event.target.value, 'contains')" />
                                            <label for="" class="-top-3">Name</label>
                                        </span>

                                    </p-iconField>
                                </div>
                            </div>

                            <div class="flex flex-wrap gap-2">
                                <button pButton label="New Reason" class="p-button-outlined" icon="pi pi-plus"
                                    (click)="onEdit(undefined)"></button>
                            </div>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width:3rem !important;">
                                <div class="flex justify-center items-center">
                                    #
                                </div>
                            </th>
                            <th pSortableColumn="code" style="width:4rem !important;">
                                <div class="flex justify-center items-center">
                                    Code
                                </div>
                            </th>
                            <th pSortableColumn="reasonName">
                                <div class="flex justify-center items-center">
                                    Name
                                </div>
                            </th>
                            <th pSortableColumn="shiftStartRange" class="w-36">
                                <div class="flex justify-center items-center">
                                    Payroll Link Code
                                </div>
                            </th>
                            <th pSortableColumn="nhinTime">
                                <div class="flex justify-center items-center">
                                    Arabic Name
                                </div>
                            </th>
                            <th pSortableColumn="latestAllowed" class="w-20">
                                <div class="flex justify-center items-center">
                                    Color
                                </div>
                            </th>
                            <th pSortableColumn="earliestAllowed" class="w-24">
                                <div class="flex justify-center items-center">
                                    Sys. Code
                                </div>
                            </th>
                            <th pSortableColumn="nhoutTime" class="w-20">
                                <div class="flex justify-center items-center">
                                    Excuse
                                </div>
                            </th>
                            <th pSortableColumn="shiftEndRange" class="w-28">
                                <div class="flex justify-center items-center">
                                    Excuse Type
                                </div>
                            </th>
                            <th pSortableColumn="nh" class="w-28">
                                <div class="flex justify-center items-center">
                                    Miss Hours
                                </div>
                            </th>
                            <th pSortableColumn="isRotaShift" class="w-20">
                                <div class="flex justify-center items-center">
                                    Leave
                                </div>
                            </th>
                            <th pSortableColumn="dgv_Active" class="w-16">
                                <div class="flex justify-center items-center">
                                    Active
                                </div>
                            </th>

                            <th class="text-center w-32">Actions</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-rowIndex="rowIndex" let-data>
                        <tr>
                            <td class="text-center text-surface-900 dark:text-surface-0">{{rowIndex + 1}}</td>
                            <td class="text-left text-surface-900 dark:text-surface-0">{{data.code}}</td>
                            <td class="text-left text-surface-900 dark:text-surface-0">{{data.reasonName}}</td>
                            <td class="text-center text-surface-900 dark:text-surface-0">{{data.otherCode}}</td>
                            <td class="text-right text-surface-900 dark:text-surface-0">{{data.reasonNameArabic }}</td>
                            <td class="text-center text-surface-900 dark:text-surface-0">
                                <p-badge styleClass="shadow-lg rounded-2xl" value="" badgeSize="large"
                                    [style]="{ 'background': data.color }" />
                            </td>
                            <td class="text-center text-surface-900 dark:text-surface-0">
                                <p-tag styleClass="shadow-lg" *ngIf="data.systemCd" icon="pi pi-check" severity="success"
                                    value="YES" />
                                <p-tag styleClass="shadow-lg" *ngIf="!data.systemCd" icon="pi pi-times" severity="danger"
                                    value="NO" />
                            </td>
                            <td class="text-center text-surface-900 dark:text-surface-0">

                                <i class="pi" styleClass="shadow-lg"
                                    [ngClass]="data.excuseReason ? 'text-green-500 pi-check-circle' : 'text-red-500 pi-times-circle'"></i>
                            </td>
                            <td class="text-center text-surface-900 dark:text-surface-0">
                                <p-tag *ngIf="data.excuseType < 3" styleClass="shadow-lg" severity="info"
                                    [value]="getExcuseType(data.excuseType)" />
                            </td>
                            <td class="text-center text-surface-900 dark:text-surface-0">
                                <i class="pi" styleClass="shadow-lg"
                                    [ngClass]="data.deductMissHrs ? 'text-green-500 pi-check-circle' : 'text-red-500 pi-times-circle'"></i>
                            </td>
                            <td class="text-center text-surface-900 dark:text-surface-0">
                                <i class="pi" styleClass="shadow-lg"
                                    [ngClass]="data.leaveRequest ? 'text-green-500 pi-check-circle' : 'text-red-500 pi-times-circle'"></i>
                            </td>
                            <td class="text-center text-surface-900 dark:text-surface-0">
                                <i class="pi"
                                    [ngClass]="data.active ? 'text-green-500 pi-check-circle' : 'text-red-500 pi-times-circle'"></i>
                            </td>
                            <td class="text-center text-surface-900 dark:text-surface-0">
                                <button pButton pRipple icon="icon-pencil" pTooltip="Edit"
                                    class="mr-2 p-button-rounded p-button-success p-button-outlined"
                                    (click)="onEdit(data)"></button>
                                <button pButton pRipple icon="icon-trash-2" pTooltip="Delete"
                                    class="mr-2 p-button-rounded p-button-danger p-button-outlined"
                                    (click)="deleteConfirm($event, data)"></button>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
                <p-sidebar [(visible)]="showAddPanel" position="right">
                    <ng-template pTemplate="header">
                        <div class="text-xl font-bold">
                            Reason Infomote
                        </div>
                    </ng-template>
                    <ng-template pTemplate="content">
                        <form [formGroup]="form">
                            <formly-form [model]="model" [fields]="fields" [options]="formOptions"
                                [form]="form"></formly-form>

                            <!-- <div class="w-full py-2">
                                                <label for="float-label" class="font-medium text-surface-900 dark:text-surface-0">Reimbursement</label>
                                                <div class="flex w-auto items-center">
                                                    <p-inputSwitch class="p-inputSwitch-lg" id="visa-cost"
                                                        triggers="focus"></p-inputSwitch>
                                                </div>
                                            </div> -->
                        </form>

                    </ng-template>
                    <ng-template pTemplate="footer">
                        <div class="flex gap-2 justify-end">
                            <p-button type="submit" label="Update" severity="primary" [outlined]="false"
                                [loading]="isLoading" icon="pi pi-check" class="ml-auto"
                                (onClick)="onSubmit()"></p-button>
                            <p-button label="Cancel" severity="primary" [outlined]="true" text="true" icon="pi pi-times"
                                (onClick)="showAddPanel = !showAddPanel"></p-button>
                        </div>
                    </ng-template>
                </p-sidebar>
            </div>
        </div>
    </div>
</div>