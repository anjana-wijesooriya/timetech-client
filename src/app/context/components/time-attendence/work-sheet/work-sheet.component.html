<div class="grid support-wrapper woraksheet-wrapper">

    <div class="flex flex-wrap w-full p-2 mb-3 justify-content-center surface-ground">

        <p-confirmDialog></p-confirmDialog>
        <p-toast></p-toast>
        <div class="flex flex-wrap items-center justify-center w-full h-full">

            <div *ngIf="viewType==1"
                class="block w-full p-3 m-0 rounded-lg bg-gray-2 card surface-card page-content-wrapper shadow-secondary-1 dark:bg-surface-dark dark:text-white text-surface animate-fade-right">
                <div class="flex w-full pb-3 mb-3 card-header border-bottom-1 surface-border justify-content-between">
                    <div class="flex flex-wrap justify-between gap-3 align-items-center">
                        <p-button icon="pi pi-arrow-left text-xl" [rounded]="true" [outlined]="true" severity="primary"
                            (onClick)="goBack()" />
                        <h5 class="m-0">Edit Attendance</h5>
                    </div>
                    <div class="flex flex-wrap">

                        <button type="button" pButton pRipple label="Update" icon="pi pi-save"
                            class="bg-orange-500 rounded-none shadow-lg p-button-primary shadow-orange-500/50 hover:shadow-sm hover:border-gray-500"
                            (click)="onUpdateAttendance()" [loading]="isUpdating"></button>
                        <button type="button" pButton pRipple label="Calculate" icon="pi pi-calculator"
                            class="bg-green-500 rounded-none shadow-lg p-button-success shadow-green-500/50 hover:shadow-sm hover:border-gray-500"
                            (click)="onCalculate()" [loading]="calculating"></button>
                        <button type="button" pButton pRipple label="Refresh" icon="pi pi-sync"
                            class="bg-blue-500 rounded-none shadow-lg p-button-info shadow-blue-500/50 hover:shadow-sm hover:border-gray-500"
                            (click)="refreshData()" [loading]="isRefreshing"></button>
                        <!-- <button type="button" pButton pRipple label="Reset" icon="pi pi-save"
                            class="bg-purple-500 rounded-none shadow-lg p-button-help shadow-purple-500/50 hover:shadow-sm hover:border-gray-500"
                            (click)="onUpdateAttendance()" [loading]="isUpdating"></button> -->

                    </div>
                </div>
                <div class="border-t-2 border-teal-400 w-Full" *ngIf="selectedWorksheet">
                    <form class="w-Full" [formGroup]="formgroup">
                        <div class="flex flex-wrap justify-around gap-2">
                            <div
                                class="relative items-center w-1/6 p-2 transition duration-500 border rounded-md shadow-sm hover:shadow-md hover:shadow-teal-400">
                                <input type="text" id="floating_outlined"
                                    class="block px-2.5 pb-2.5 pt-4 w-full  text-gray-900 bg-transparent rounded-lg border-1 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                                    placeholder=" " readonly [value]="selectedWorksheet.empCd" />
                                <label for="floating_outlined"
                                    class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto start-1">
                                    Employee Code
                                </label>
                            </div>
                            <div
                                class="relative items-center w-1/6 p-2 transition duration-500 border rounded-md shadow-sm hover:shadow-md hover:shadow-teal-400">
                                <input type="text" id="floating_outlined"
                                    class="block px-2.5 pb-2.5 pt-4 w-full  text-gray-900 bg-transparent rounded-lg border-1 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                                    placeholder=" " readonly [value]="selectedWorksheet.empName" />
                                <label for="floating_outlined"
                                    class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto start-1">
                                    Employee Name
                                </label>
                            </div>
                            <div
                                class="relative items-center w-1/6 p-2 transition duration-500 border rounded-md shadow-sm hover:shadow-md hover:shadow-teal-400">
                                <input type="text" id="floating_outlined"
                                    class="block px-2.5 pb-2.5 pt-4 w-full  text-gray-900 bg-transparent rounded-lg border-1 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                                    placeholder=" " readonly [value]="selectedWorksheet.deptDs" />
                                <label for="floating_outlined"
                                    class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto start-1">
                                    Department
                                </label>
                            </div>
                            <div
                                class="relative items-center w-1/6 p-2 transition duration-500 border rounded-md shadow-sm hover:shadow-md hover:shadow-teal-400">
                                <input type="text" id="floating_outlined"
                                    class="block px-2.5 pb-2.5 pt-4 w-full text-gray-900 bg-transparent rounded-lg border-1 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                                    placeholder=" " readonly [value]="getLocalDate(selectedWorksheet.trnDate)" />
                                <label for="floating_outlined"
                                    class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto start-1">
                                    Date
                                </label>
                            </div>
                            <div
                                class="relative items-center w-1/6 p-2 transition duration-500 border rounded-md shadow-sm hover:shadow-md hover:shadow-teal-400">


                                <p-dropdown [options]="reasons" formControlName="reason" [checkmark]="true"
                                    optionLabel="reasonName" optionValue="code" [showClear]="true"
                                    placeholder="Select a Reason" styleClass="w-full"
                                    class="block px-2.5 pb-2 pt-2 w-full text-sm text-gray-900 bg-transparent rounded-lg border-1 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer" />
                                <label for="floating_outlined"
                                    class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto start-1">
                                    Reason
                                </label>
                            </div>

                        </div>
                        <div class="grid grid-cols-2 grid-rows-1 gap-2 mt-3">
                            <div class="space-y-2">
                                <p-panel>
                                    <ng-template pTemplate="header">
                                        <div class="flex w-full justify-content-between align-items-center">
                                            <h6 class="m-0 font-bold">
                                                IN - OUT
                                            </h6>
                                            <div class="flex flex-wrap">

                                                <button type="button" pButton pRipple label="Add Leave"
                                                    icon="pi pi-sign-out"
                                                    class="bg-blue-500 rounded-none shadow-lg p-button-info shadow-blue-500/50 hover:shadow-sm hover:border-gray-500"
                                                    (click)="onOpenShiftSlide(0)"></button>
                                                <button type="button" pButton pRipple label="Change Shift"
                                                    icon="pi pi-undo"
                                                    class="bg-orange-500 rounded-none shadow-lg p-button-primary shadow-orange-500/50 hover:shadow-sm hover:border-gray-500"
                                                    (click)="onOpenShiftSlide(1)"></button>
                                            </div>
                                        </div>
                                    </ng-template>
                                    <div class="grid grid-cols-2 gap-4 formgrid">
                                        <div class="w-full col-12 md:col-6 p-fluid">
                                            <label for="float-label" class="font-medium text-900">Shift IN</label>
                                            <p-calendar [showIcon]="true" [iconDisplay]="'input'" [showTime]="true"
                                                [timeOnly]="true" ariaLabel="Date"
                                                formControlName="shiftIN"></p-calendar>
                                            <small class="p-error" id="username-help"></small>
                                        </div>
                                        <div class="w-full col-12 md:col-6 p-fluid">
                                            <label for="float-label" class="font-medium text-900">Shift OUT</label>
                                            <p-inputGroup>
                                                <p-calendar [timeOnly]="true" [hourFormat]="24" [showIcon]="true"
                                                    [iconDisplay]="'input'" inputStyleClass="border-noround-right"
                                                    disabled="true" formControlName="shiftOUT"></p-calendar>
                                                <p-inputGroupAddon>
                                                    <p-checkbox [binary]="true" pTooltip="Next Day" disabled="true"
                                                        formControlName="shiftOutNextDay" /></p-inputGroupAddon>
                                            </p-inputGroup>
                                            <small class="p-error" id="username-help"></small>
                                        </div>
                                        <div class="w-full col-12 md:col-6 p-fluid">
                                            <label for="float-label" class="font-medium text-900">IN</label>
                                            <div class="relative">
                                                <div
                                                    class="absolute inset-y-0 end-0 top-0 flex items-center pe-3.5 pointer-events-none">
                                                    <i class="pi pi-clock"></i>
                                                </div>
                                                <input pInputText class="w-full" [ngxTimepicker]="picker1"
                                                    [value]="getTime('timeIn')" [format]="24" />
                                                <ngx-material-timepicker [preventOverlayClick]="true"
                                                    [preventOverlayClick]="true" [minutesGap]="5" #picker1
                                                    (timeChanged)="ontimeChange($event, 'timeIn')"
                                                    [enableKeyboardInput]="true"></ngx-material-timepicker>
                                            </div>
                                        </div>
                                        <div class="w-full col-12 md:col-6 p-fluid">
                                            <label for="float-label" class="font-medium text-900">Out</label>
                                            <div class="relative">
                                                <p-inputGroup>
                                                    <div
                                                        class="absolute inset-y-0 end-10 top-0 flex items-center pe-3.5 pointer-events-none">
                                                        <i class="pi pi-clock"></i>
                                                    </div>
                                                    <input pInputText class="w-full" [ngxTimepicker]="picker2"
                                                        [value]="getTime('timeOut')" [format]="24" />
                                                    <ngx-material-timepicker [preventOverlayClick]="true"
                                                        [preventOverlayClick]="true" [minutesGap]="5" #picker2
                                                        (timeChanged)="ontimeChange($event, 'timeOut')"
                                                        [enableKeyboardInput]="true"></ngx-material-timepicker>
                                                    <p-inputGroupAddon>
                                                        <p-checkbox [binary]="true"
                                                            pTooltip="Next Day" /></p-inputGroupAddon>
                                                </p-inputGroup>

                                            </div>
                                        </div>

                                    </div>
                                </p-panel>
                                <div class="flex gap-3 card flex-column md:flex-row">
                                    <div class="grid grid-cols-2 gap-4 formgrid">
                                        <div class="w-full col-12 md:col-6 p-fluid">
                                            <label for="float-label" class="font-medium text-900">Shift</label>
                                            <p-dropdown [options]="shifts" [checkmark]="true" optionLabel="shiftCode"
                                                formControlName="shift" optionValue="code" [showClear]="true"
                                                placeholder="Select a Shift" />
                                        </div>
                                        <div class="w-full col-12 md:col-6 p-fluid">
                                            <label for="float-label" class="font-medium text-900">Work Rule</label>
                                            <p-dropdown [options]="workRules" [checkmark]="true" optionLabel="name"
                                                formControlName="wr" optionValue="code" [showClear]="true"
                                                placeholder="Select a Work Rule" />
                                        </div>
                                        <div class="w-full col-12 md:col-6 p-fluid">
                                            <label for="nickname2" class="w-full font-medium text-900">Emp
                                                Explanation</label>
                                            <textarea id="address" rows="3" cols="30" pInputTextarea class="w-full"
                                                formControlName="empRemarks" name="notes"></textarea>
                                        </div>
                                        <div class="w-full col-12 md:col-6 p-fluid">
                                            <label for="nickname2" class="w-full font-medium text-900">Remarks</label>
                                            <textarea id="address" rows="3" cols="30" pInputTextarea class="w-full"
                                                formControlName="remarks" name="notes"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <p-panel>
                                    <ng-template pTemplate="header">
                                        <div class="flex w-full justify-content-between align-items-center">
                                            <h6 class="m-0 font-bold">
                                                Results
                                            </h6>
                                            <div class="flex flex-wrap">
                                                <button type="button" pButton pRipple label="Reset Data"
                                                    icon="pi pi-undo"
                                                    class="bg-orange-500 rounded-none shadow-lg p-button-primary shadow-orange-500/50 hover:shadow-sm hover:border-gray-500"
                                                    (click)="resetData()"></button>
                                            </div>
                                        </div>
                                    </ng-template>
                                    <div class="grid grid-cols-3 gap-3 formgrid">
                                        <div class="w-full col-12 md:col-6 p-fluid">
                                            <label for="float-label" class="font-medium text-900">NH</label>
                                            <div class="relative">
                                                <div
                                                    class="absolute inset-y-0 end-0 top-0 flex items-center pe-3.5 pointer-events-none">
                                                    <i class="pi pi-clock"></i>
                                                </div>
                                                <input pInputText class="w-full" [ngxTimepicker]="picker11"
                                                    [value]="getTime('nh')" [format]="24" />
                                                <ngx-material-timepicker [preventOverlayClick]="true" [minutesGap]="5"
                                                    #picker11 (timeChanged)="ontimeChange($event, 'nh')"
                                                    [enableKeyboardInput]="true"></ngx-material-timepicker>
                                            </div>
                                        </div>
                                        <div class="w-full col-12 md:col-6 p-fluid">
                                            <label for="float-label" class="font-medium text-900">Miss Time</label>
                                            <div class="relative">
                                                <div
                                                    class="absolute inset-y-0 end-0 top-0 flex items-center pe-3.5 pointer-events-none">
                                                    <i class="pi pi-clock"></i>
                                                </div>
                                                <input pInputText class="w-full" [ngxTimepicker]="picker12"
                                                    [value]="getTime('missTime')" [format]="24" />
                                                <ngx-material-timepicker [preventOverlayClick]="true" [minutesGap]="5"
                                                    #picker12 (timeChanged)="ontimeChange($event, 'missTime')"
                                                    [enableKeyboardInput]="true"></ngx-material-timepicker>
                                            </div>
                                        </div>
                                        <div class="w-full col-12 md:col-6 p-fluid">
                                            <label for="float-label" class="font-medium text-900">Break Hrs</label>
                                            <div class="relative">
                                                <div
                                                    class="absolute inset-y-0 end-0 top-0 flex items-center pe-3.5 pointer-events-none">
                                                    <i class="pi pi-clock"></i>
                                                </div>
                                                <input pInputText class="w-full" [ngxTimepicker]="picker13"
                                                    [value]="getTime('brkHrs')" [format]="24" />
                                                <ngx-material-timepicker [preventOverlayClick]="true" [minutesGap]="5"
                                                    #picker13 (timeChanged)="ontimeChange($event, 'brkHrs')"
                                                    [enableKeyboardInput]="true"></ngx-material-timepicker>
                                            </div>
                                        </div>
                                        <div class="w-full col-12 md:col-6 p-fluid">
                                            <label for="float-label" class="font-medium text-900">OT1</label>
                                            <div class="relative">
                                                <div
                                                    class="absolute inset-y-0 end-0 top-0 flex items-center pe-3.5 pointer-events-none">
                                                    <i class="pi pi-clock"></i>
                                                </div>
                                                <input pInputText class="w-full" [ngxTimepicker]="picker14"
                                                    [value]="getTime('oT1')" [format]="24" />
                                                <ngx-material-timepicker [preventOverlayClick]="true" [minutesGap]="5"
                                                    #picker14 (timeChanged)="ontimeChange($event, 'oT1')"
                                                    [enableKeyboardInput]="true"></ngx-material-timepicker>
                                            </div>
                                        </div>
                                        <div class="w-full col-12 md:col-6 p-fluid">
                                            <label for="float-label" class="font-medium text-900">OT2</label>
                                            <div class="relative">
                                                <div
                                                    class="absolute inset-y-0 end-0 top-0 flex items-center pe-3.5 pointer-events-none">
                                                    <i class="pi pi-clock"></i>
                                                </div>
                                                <input pInputText class="w-full" [ngxTimepicker]="picker15"
                                                    [value]="getTime('oT2')" [format]="24" />
                                                <ngx-material-timepicker [preventOverlayClick]="true" [minutesGap]="5"
                                                    #picker15 (timeChanged)="ontimeChange($event, 'oT2')"
                                                    [enableKeyboardInput]="true"></ngx-material-timepicker>
                                            </div>
                                        </div>
                                        <div class="w-full col-12 md:col-6 p-fluid">
                                            <label for="float-label" class="font-medium text-900">OT3</label>
                                            <div class="relative">
                                                <div
                                                    class="absolute inset-y-0 end-0 top-0 flex items-center pe-3.5 pointer-events-none">
                                                    <i class="pi pi-clock"></i>
                                                </div>
                                                <input pInputText class="w-full" [ngxTimepicker]="picker16"
                                                    [value]="getTime('oT3')" [format]="24" />
                                                <ngx-material-timepicker [preventOverlayClick]="true" [minutesGap]="5"
                                                    #picker16 (timeChanged)="ontimeChange($event, 'oT3')"
                                                    [enableKeyboardInput]="true"></ngx-material-timepicker>
                                            </div>
                                        </div>
                                        <div class="w-full col-12 md:col-6 p-fluid">
                                            <label for="float-label" class="font-medium text-900">Late Entry</label>
                                            <div class="relative">
                                                <div
                                                    class="absolute inset-y-0 end-0 top-0 flex items-center pe-3.5 pointer-events-none">
                                                    <i class="pi pi-clock"></i>
                                                </div>
                                                <input pInputText class="w-full" [ngxTimepicker]="picker17"
                                                    [value]="getTime('lateEntryHrs')" [format]="24" />
                                                <ngx-material-timepicker [preventOverlayClick]="true" [minutesGap]="5"
                                                    #picker17 (timeChanged)="ontimeChange($event, 'lateEntryHrs')"
                                                    [enableKeyboardInput]="true"></ngx-material-timepicker>
                                            </div>
                                        </div>
                                        <div class="w-full col-12 md:col-6 p-fluid">
                                            <label for="float-label" class="font-medium text-900">Early Exit</label>
                                            <div class="relative">
                                                <div
                                                    class="absolute inset-y-0 end-0 top-0 flex items-center pe-3.5 pointer-events-none">
                                                    <i class="pi pi-clock"></i>
                                                </div>
                                                <input pInputText class="w-full" [ngxTimepicker]="picker18"
                                                    [value]="getTime('earlyExitHrs')" [format]="24" />
                                                <ngx-material-timepicker [preventOverlayClick]="true" [minutesGap]="5"
                                                    #picker18 (timeChanged)="ontimeChange($event, 'earlyExitHrs')"
                                                    [enableKeyboardInput]="true"></ngx-material-timepicker>
                                            </div>
                                        </div>
                                    </div>
                                </p-panel>
                                <div class="w-full align-items-start" *ngIf="false">
                                    <p-fileUpload mode="advanced" chooseLabel="Add Attachment" name="files"
                                        ngDefaultControl [formControl]="uploadControl" chooseIcon="pi pi-upload"
                                        multiple="true" [url]="fileUploadUrl" accept="image/*, application/pdf"
                                        [auto]="true" maxFileSize="1000000" (onUpload)="onUploadImage($event)"
                                        (onSelect)="onBeforeUpload($event)" (onError)="onUploadError($event)"
                                        #fileUploader fileLimit="1">
                                        <ng-template pTemplate="content" let-files let-uploadedFiles="uploadedFiles"
                                            let-removeFileCallback="removeFileCallback"
                                            let-removeUploadedFileCallback="removeUploadedFileCallback">
                                            <div *ngIf="files?.length > 100">
                                                <h5>Pending</h5>
                                                <div class="flex flex-wrap gap-5 p-0 sm:p-5">
                                                    <div *ngFor="let file of files; let i = index"
                                                        class="flex gap-3 px-6 m-0 card flex-column border-1 surface-border align-items-center">
                                                        <div>
                                                            <img role="presentation" [alt]="file.name"
                                                                [src]="file.objectURL" width="100" height="50" />
                                                        </div>
                                                        <span class="font-semibold">{{ file.name
                                                            }}</span>
                                                        <div>{{ formatSize(file.size) }}</div>
                                                        <p-badge value="Pending" severity="warning" />
                                                        <p-button icon="pi pi-times"
                                                            (click)="onRemoveTemplatingFile($event, file, removeFileCallback, index)"
                                                            [outlined]="true" [rounded]="true" severity="danger" />
                                                    </div>
                                                </div>

                                            </div>
                                            <!-- <div *ngIf="selectedTicket.attachment1 != ''">
                                            <div class="flex flex-wrap p-0 justify-content-center">
                                                <div
                                                    class="flex w-full row-gap-2 p-2 m-0 card flex-column border-1 surface-border align-items-center">
                                                    <div>
                                                        <p-avatar
                                                            [icon]="getDocumentIconByUrl(selectedTicket.attachment1)"
                                                            styleClass="w-12rem h-8rem"> </p-avatar>
                                                    </div>
                                                    <div class="flex flex-row gap-2">
                                                        <p-button icon="pi pi-times" (onClick)="removeAttachment(0)"
                                                            [outlined]="true" [rounded]="true" severity="danger"
                                                            styleClass="w-2rem h-2rem" />
                                                        <p-button icon="pi pi-download"
                                                            (onClick)="downloadAttachment(selectedTicket.attachment1)"
                                                            [outlined]="true" [rounded]="true" severity="info"
                                                            styleClass="w-2rem h-2rem" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div> -->
                                        </ng-template>
                                        <ng-template pTemplate="file"> </ng-template>
                                    </p-fileUpload>
                                    <small class="p-error" id="username-help">Attachment
                                        required.</small>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 grid-rows-1 gap-2 mt-3">
                            <div class="relative leading-none shadow-xl">
                                <div class="flex w-full bg-white ">
                                    <div class="flex flex-wrap items-baseline self-start flex-auto p-2">
                                        <p-table [rowHover]="true" [value]="punchData" [loading]="isLoadingPunchData"
                                            styleClass="p-datatable-gridlines w-full" scrollHeight="20rem"
                                            [scrollable]="true" [tableStyle]="{ 'min-width': '10rem' }"
                                            tableStyleClass="w-full" [autoLayout]="true"
                                            tableStyleClass="table-layout-fixed">
                                            <ng-template pTemplate="caption">
                                                <div class="flex">
                                                    <h5 class="m-0">Processed Machine Data</h5>
                                                </div>
                                            </ng-template>
                                            <ng-template pTemplate="header">
                                                <tr>
                                                    <th>#</th>
                                                    <th>Day</th>
                                                    <th>Date</th>
                                                    <th>Time</th>
                                                    <th>MID</th>
                                                    <th>Location</th>
                                                    <th>Type</th>
                                                </tr>
                                            </ng-template>
                                            <ng-template pTemplate="body" let-rowIndex="rowIndex" let-data>
                                                <tr>
                                                    <td>{{ rowIndex + 1 }}</td>
                                                    <td>{{ getDay(data.trnDtTime) }}</td>
                                                    <td>{{ getUTCFormattedDate(data.trnDate) | date :'shortDate' }}</td>
                                                    <td>{{ data.trnTime }}</td>
                                                    <td>{{ data.machinID }}</td>
                                                    <td>{{ data.machName }}</td>
                                                    <td class="text-center">
                                                        <div
                                                            class="w-10 h-10 flex items-center justify-center rounded-full text-base tracking-[0.15px] font-bold bg-primary-600 text-white dark:bg-primary-200 dark:text-neutral-900">
                                                            {{ data.terminalType }}
                                                        </div>
                                                    </td>
                                                </tr>
                                            </ng-template>
                                        </p-table>
                                    </div>
                                </div>
                            </div>
                            <div class="relative leading-none shadow-xl">
                                <div class="flex w-full bg-white ">
                                    <div class="flex flex-wrap items-baseline self-start flex-auto p-2">
                                        <p-table [rowHover]="true" [value]="machineData"
                                            styleClass="p-datatable-gridlines w-full" scrollHeight="20rem"
                                            [scrollable]="true" [tableStyle]="{ 'min-width': '10rem' }"
                                            tableStyleClass="w-full" [autoLayout]="true"
                                            tableStyleClass="table-layout-fixed" [loading]="isLoadingPunchData">
                                            <ng-template pTemplate="caption">
                                                <div class="flex justify-between align-items-center">
                                                    <h5 class="m-0">Machine Data</h5>
                                                    <button type="button" pButton pRipple label="Add"
                                                        icon="pi pi-search"
                                                        class="bg-orange-500 rounded-none shadow-lg p-button-primary shadow-orange-500/50 hover:shadow-sm hover:border-gray-500"
                                                        (click)="bindPunchForm()"></button>
                                                </div>
                                            </ng-template>
                                            <ng-template pTemplate="header">
                                                <tr>
                                                    <th>#</th>
                                                    <th>Day</th>
                                                    <th>Date</th>
                                                    <th>Time</th>
                                                    <th>MID</th>
                                                    <th>Location</th>
                                                    <th class="text-center">In/Out</th>
                                                    <th class="text-center">Punch</th>
                                                    <th class="text-center">Type</th>
                                                    <th class="text-center">Delete</th>
                                                </tr>
                                            </ng-template>
                                            <ng-template pTemplate="body" let-data let-rowIndex="rowIndex">
                                                <tr>
                                                    <td>{{ rowIndex + 1 }}</td>
                                                    <td>{{ getDay(data.trnDtTime) }}</td>
                                                    <td>{{ getUTCFormattedDate(data.trnDate)| date :'shortDate' }}</td>
                                                    <td>{{ data.i }}</td>
                                                    <td>{{ data.machinID }}</td>
                                                    <td>{{ data.machName }}</td>
                                                    <td>
                                                        <div
                                                            class="inline-flex flex-row items-center border border-secondary-100 dark:border-secondary-700 gap-2 h-8 py-1.5 px-3 bg-secondary-100 dark:bg-secondary-700 rounded-lg text-sm tracking-[.00714em]">
                                                            {{ data.trnTypeS }}
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <i class="pi"
                                                            [ngClass]="data.machinePunch ? 'text-green-500 pi-check-circle' : 'text-red-500 pi-times-circle'"></i>
                                                    </td>
                                                    <td>
                                                        <div
                                                            class="w-10 h-10 flex items-center justify-center rounded-full text-base tracking-[0.15px] font-bold bg-primary-600 text-white dark:bg-primary-200 dark:text-neutral-900">
                                                            {{ data.terminalType }}
                                                        </div>

                                                    </td>
                                                    <td>
                                                        <button pButton pRipple icon="icon-trash-2" pTooltip="Delete"
                                                            class="mr-2 p-button-rounded p-button-danger p-button-outlined"
                                                            (click)="deleteConfirm($event, data)"></button>
                                                    </td>
                                                </tr>
                                            </ng-template>
                                        </p-table>


                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div *ngIf="viewType==0"
                class="block w-full p-3 m-0 rounded-lg bg-gray-2 card surface-card page-content-wrapper shadow-secondary-1 dark:bg-surface-dark dark:text-white text-surface animate-fade-right">
                <div #cardHeader id="card-header"
                    class="flex flex-wrap w-full pb-3 mb-3 card-header border-bottom-1 surface-border justify-content-between">
                    <div class="flex flex-wrap gap-3 align-items-center">
                        <!-- <p-button icon="pi pi-arrow-left text-xl" [rounded]="true" [outlined]="true" severity="primary"
                                /> -->
                        <h5 class="m-0">Daily Worksheet</h5>
                    </div>
                    <div class="flex flex-wrap gap-3">
                    </div>
                </div>
                <div class="flex flex-wrap w-full justify-content-center ">
                    <div
                        class="block px-4 pt-3 pb-2 bg-white rounded-lg text-surface shadow-secondary-1 dark:bg-surface-dark dark:text-white">
                        <div class="grid grid-cols-3 gap-2">

                            <div class="field p-fluid">
                                <small id="username-help">
                                    Start Date
                                </small>
                                <p-calendar [iconDisplay]="'input'" [showIcon]="true" placeholder="Select From Date"
                                    [(ngModel)]="fromDate" styleClass="w-full"></p-calendar>
                            </div>
                            <div class="field p-fluid">
                                <small id="username-help">
                                    Company
                                </small>
                                <p-dropdown [options]="companies" [showClear]="false" placeholder="Filter by Company"
                                    [(ngModel)]="selectedCompany" (onChange)="onChangeCompany()" styleClass="w-full">
                                    <ng-template let-selectedValue pTemplate="selectedItem">
                                        <div class="flex gap-2 align-items-center" *ngIf="selectedValue">
                                            <img src="assets/context/images/flag/flag_placeholder.png"
                                                [class]="'flag flag-' + selectedValue.logo" style="width: 21px" />
                                            <div>{{ selectedValue.name }}</div>
                                        </div>
                                    </ng-template>
                                    <ng-template let-company pTemplate="item">
                                        <div class="flex gap-2 align-items-center">
                                            <img src="assets/context/images/flag/flag_placeholder.png"
                                                [class]="'flag flag-' + company.logo" style="width: 21px" />
                                            <div>{{ company.name }}</div>
                                        </div>
                                    </ng-template>
                                </p-dropdown>
                            </div>
                            <div class="field p-fluid">
                                <small id="username-help">
                                    Reasons
                                </small>
                                <p-dropdown [options]="reasons" [(ngModel)]="selectedReason" [checkmark]="true"
                                    optionLabel="reasonName" optionValue="code" [showClear]="true"
                                    placeholder="Select a Reason" styleClass="w-full" />
                            </div>
                            <div class="field p-fluid">
                                <small id="username-help">
                                    End Date
                                </small>
                                <p-calendar [iconDisplay]="'input'" [showIcon]="true" placeholder="Select To Date"
                                    [(ngModel)]="toDate" styleClass="w-full"></p-calendar>
                            </div>
                            <div class="field p-fluid">
                                <small id="username-help">
                                    Departments
                                </small>
                                <p-treeSelect class="w-full" styleClass="w-full" containerStyleClass="w-full"
                                    [options]="departmentTree" placeholder="Select a Department"
                                    selectionMode="checkbox" display="chip" [(ngModel)]="selectedDepartments"
                                    metaKeySelection="true" (onNodeSelect)="nodeSelect($event)"
                                    (onNodeUnselect)="nodeUnselect($event)">
                                </p-treeSelect>

                            </div>
                            <div class="field p-fluid">
                                <small id="username-help">
                                    Employees
                                </small>
                                <p-multiSelect [options]="employees" [(ngModel)]="selectedEmployees"
                                    placeholder="Select Employees" optionLabel="empName" optionValue="empID"
                                    display="chip" [showClear]="true" styleClass="w-full">
                                    <ng-template let-employee pTemplate="item">
                                        <div class="flex gap-2 align-items-center">
                                            <b>[{{ employee.empCd }}] - </b>
                                            <div>{{ employee.empName }}</div>
                                        </div>
                                    </ng-template>
                                    <!-- <ng-template let-value pTemplate="selectedItems">
                                            <div class="inline-flex gap-2 px-1 align-items-center" *ngFor="let option of value">
                                                <div>{{ option.empName }},</div>
                                            </div>
                                            <div *ngIf="!value || value.length === 0">Select Employees</div>
                                        </ng-template> -->
                                </p-multiSelect>
                            </div>
                            <div class="field p-fluid">
                                <small id="username-help">
                                    Employee Code
                                </small>
                                <input type="text" [(ngModel)]="empCode" pInputText
                                    placeholder="Search by Employee Code..." class="w-full" />
                            </div>
                            <div class="field p-fluid">
                                <small id="username-help">
                                    Employee Name
                                </small>
                                <input type="text" [(ngModel)]="empName" pInputText
                                    placeholder="Search by Employee Name..." class="w-full" />
                            </div>
                            <div class="flex flex-wrap field">
                                <small id="username-help" class="w-full m-0 opacity-0">
                                    Employee Name
                                </small>
                                <button type="button" pButton pRipple label="Search" icon="pi pi-search"
                                    class="bg-orange-500 rounded-none shadow-lg grow p-button-primary shadow-orange-500/50 hover:shadow-sm hover:border-gray-500"
                                    (click)="onGetTableEntries()"></button>
                                <button type="button" pButton pRipple label="Process Data" icon="pi pi-sync"
                                    class="bg-blue-500 rounded-none shadow-lg grow p-button-info shadow-blue-500/50 hover:shadow-sm hover:border-gray-500"
                                    (click)="processData()"></button>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex flex-wrap justify-center w-full mt-2 ">
                    <p-table #supportTable [rowHover]="true" [value]="virtualWorksheets" [loading]="isLoading"
                        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                        [rows]="rowsPerPage" [showCurrentPageReport]="true" (onPage)="pageChange($event)"
                        [rowsPerPageOptions]="[25, 50, 100]" dataKey="code" [first]="first" [paginator]="true"
                        styleClass="p-datatable-gridlines" scrollHeight="calc(100vh - 40rem)" class="border-round"
                        tableStyleClass="w-full" [scrollable]="true" [style]="getTableWidth">
                        <ng-template pTemplate="header">
                            <tr>
                                <th style="width:3.5rem !important;" alignFrozen="left" pFrozenColumn>
                                    <div class="flex justify-content-center align-items-center">
                                        #
                                    </div>
                                </th>
                                <th pSortableColumn="code" alignFrozen="left" pFrozenColumn>
                                    <div class="flex justify-content-center align-items-center">
                                        Code
                                    </div>
                                </th>
                                <th pSortableColumn="name" alignFrozen="left" pFrozenColumn>
                                    <div class="flex justify-content-center align-items-center">
                                        Employee
                                    </div>
                                </th>
                                <!-- <th pSortableColumn="shiftStartRange">
                                    <div class="flex justify-content-center align-items-center">
                                        Department
                                    </div>
                                </th> -->
                                <th pSortableColumn="nhinTime">
                                    <div class="flex justify-content-center align-items-center">
                                        Date
                                    </div>
                                </th>
                                <!-- <th pSortableColumn="latestAllowed">
                                    <div class="flex justify-content-center align-items-center">
                                        Day
                                    </div>
                                </th> -->
                                <th pSortableColumn="earliestAllowed">
                                    <div class="flex justify-content-center align-items-center">
                                        IN
                                    </div>
                                </th>
                                <th pSortableColumn="nhoutTime">
                                    <div class="flex justify-content-center align-items-center">
                                        OUT
                                    </div>
                                </th>
                                <th pSortableColumn="shiftEndRange">
                                    <div class="flex justify-content-center align-items-center">
                                        NH
                                    </div>
                                </th>
                                <th pSortableColumn="nh">
                                    <div class="flex justify-content-center align-items-center">
                                        Miss
                                    </div>
                                </th>
                                <th pSortableColumn="dgv_Active">
                                    <div class="flex justify-content-center align-items-center">
                                        Late
                                    </div>
                                </th>
                                <th pSortableColumn="isRotaShift">
                                    <div class="flex justify-content-center align-items-center">
                                        Early
                                    </div>
                                </th>
                                <th pSortableColumn="isRotaShift">
                                    <div class="flex justify-content-center align-items-center">
                                        OT1
                                    </div>
                                </th>
                                <th pSortableColumn="isRotaShift">
                                    <div class="flex justify-content-center align-items-center">
                                        OT2
                                    </div>
                                </th>
                                <th pSortableColumn="isRotaShift">
                                    <div class="flex justify-content-center align-items-center">
                                        Break
                                    </div>
                                </th>
                                <th pSortableColumn="isRotaShift">
                                    <div class="flex justify-content-center align-items-center">
                                        Reason
                                    </div>
                                </th>
                                <th pSortableColumn="isRotaShift">
                                    <div class="flex justify-content-center align-items-center">
                                        Edit
                                    </div>
                                </th>
                                <th pSortableColumn="isRotaShift">
                                    <div class="flex justify-content-center align-items-center">
                                        Shift
                                    </div>
                                </th>
                                <th pSortableColumn="isRotaShift">
                                    <div class="flex justify-content-center align-items-center">
                                        Spcl Lv.
                                    </div>
                                </th>
                                <th class="text-center" class="w-4rem" alignFrozen="right" pFrozenColumn>Edit</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-rowIndex="rowIndex" let-data>
                            <tr class="">
                                <td class="text-center text-900" pFrozenColumn>{{rowIndex + 1}}</td>
                                <td pFrozenColumn>{{ data.empCd }}</td>
                                <td pFrozenColumn>
                                    <span class="block font-semibold text-gray-800 dark:text-neutral-200">
                                        {{ data.empName }}
                                    </span>
                                    <span
                                        class="inline-flex items-center gap-1.5 py-1 px-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-800 dark:bg-neutral-900 dark:text-neutral-200">
                                        {{ data.deptDs }}
                                    </span>
                                </td>
                                <td class="text-center">
                                    <span class="block text-gray-800 dark:text-white">
                                        {{ getUTCFormattedDate(data.trnDate) | date: 'dd/MM/yyyy'}}
                                    </span>

                                    <span class="text-sm text-gray-500 dark:text-neutral-500">
                                        ({{ getUTCFormattedDate(data.trnDate) | date: 'EEEE'}})
                                    </span>

                                </td>
                                <td class="text-center">{{ getUTCFormattedDate(data.timeIn) | date: 'HH:mm'}}</td>
                                <td class="text-center">{{ getUTCFormattedDate(data.timeOut) | date: 'HH:mm'}}</td>
                                <td class="text-center">{{ transform(data.nh) }}</td>
                                <td class="text-center">{{ transform(data.missTime) }}</td>
                                <td class="text-center"> {{ transform(data.lateEntryHrs) }}</td>
                                <td class="text-center"> {{ transform(data.earlyExitHrs) }}</td>
                                <td class="text-center"> {{ transform(data.oT1) }}</td>
                                <td class="text-center"> {{ transform(data.oT2) }}</td>
                                <td class="text-center"> {{ transform(data.brkHrs) }}</td>
                                <td class="text-center"> {{ data.multipleReason }}</td>
                                <td class="text-center text-900">
                                    <i class="pi"
                                        [ngClass]="data.edited ? 'text-green-500 pi-check-circle' : 'text-red-500 pi-times-circle'"></i>
                                </td>
                                <td> {{ data.wrName }}</td>
                                <td> {{ data.specialLeaveHrType }}</td>
                                <td class="text-center text-900" alignFrozen="right" pFrozenColumn>
                                    <button pButton pRipple icon="pi pi-pencil" pTooltip="View"
                                        class="mr-2 p-button-rounded p-button-info p-button-outlined"
                                        (click)="onEdit(data)"></button>
                                </td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="loadingbody" let-columns="columns">
                            <tr style="height:30px">
                                <td *ngFor="let col of columns; let even = even">
                                    <p-skeleton
                                        [ngStyle]="{'width': even ? (col.field === 'year' ? '30%' : '40%') : '60%'}" />
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>

                </div>
            </div>


        </div>



    </div>
    <p-sidebar [(visible)]="showAddPanel" position="right">
        <ng-template pTemplate="header">
            <div class="text-xl font-bold">
                Add Machine Data
            </div>
        </ng-template>
        <ng-template pTemplate="content">
            <form [formGroup]="punchForm">
                <div class="grid grid-cols-1 grid-rows-3 gap-2">
                    <div class="w-full col-12 md:col-6 p-fluid">
                        <label for="float-label" class="font-medium text-900">Date</label>
                        <p-calendar [showIcon]="true" [iconDisplay]="'input'" [showTime]="false" [timeOnly]="false"
                            ariaLabel="Date" formControlName="tranDate" disabled="true"></p-calendar>
                        <small class="p-error" id="username-help"></small>
                    </div>
                    <div class="w-full col-12 p-fluid">
                        <label for="float-label" class="font-medium text-900">Time</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 end-0 top-0 flex items-center pe-3.5 pointer-events-none">
                                <i class="pi pi-clock"></i>
                            </div>
                            <p-calendar [showIcon]="true" [iconDisplay]="'input'" [showTime]="true" [timeOnly]="true"
                                ariaLabel="Date" dataType="string" formControlName="tranDate"
                                formControlName="tranTime"></p-calendar>
                            <!-- <input pInputText class="w-full" [ngxTimepicker]="picker1" [value]="getPunchTime()"
                                [format]="24" readonly />
                            <ngx-material-timepicker [preventOverlayClick]="true"  [preventOverlayClick]="true"  [minutesGap]="5" #picker1 (timeChanged)="onChangePunchTime($event)"
                                [enableKeyboardInput]="true" [defaultTime]="'00:00'"></ngx-material-timepicker> -->
                        </div>
                    </div>
                    <div class="w-full col-12 md:col-6 p-fluid">
                        <label for="float-label" class="font-medium text-900">Type</label>
                        <p-selectButton [options]="['In', 'Out']" formControlName="tranType" styleClass="flex" />
                    </div>
                </div>
            </form>

        </ng-template>
        <ng-template pTemplate="footer">
            <div class="flex gap-2 justify-content-end">
                <p-button type="submit" label="Add Punch" severity="primary" [outlined]="true" [loading]="isSavingPunch"
                    icon="pi pi-check" class="ml-auto" (onClick)="onSubmitPunch()"></p-button>
                <p-button label="Cancel" severity="primary" [outlined]="true" text="true" icon="pi pi-times"
                    (onClick)="showAddPanel = !showAddPanel"></p-button>
            </div>
        </ng-template>
    </p-sidebar>
    <p-sidebar [(visible)]="showChangeShiftPanel" position="right">
        <ng-template pTemplate="header">
            <div class="text-xl font-bold" *ngIf="slideType == 0">
                Add Leave
            </div>
            <div class="text-xl font-bold" *ngIf="slideType == 1">
                Change Duty Shift
            </div>
        </ng-template>
        <ng-template pTemplate="content">
            <div class="max-w-xl pt-3">
                <div class="space-y-5">
                    <div class="grid grid-cols-1 gap-3" *ngIf="selectedWorksheet">
                        <div class="relative">
                            <div class="absolute top-2.5 left-3 flex items-center text-gray-500">
                                <label for="example12" class="block text-xs font-medium text-gray-700">Employee
                                    Name</label>
                            </div>
                            <input type="text" id="example12" readonly="true"
                                class="block w-full pt-4 border-gray-300 rounded-md shadow-sm focus:border-primary-400 focus:ring focus:ring-primary-200 focus:ring-opacity-50 disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500"
                                [value]="selectedWorksheet?.empName" />
                        </div>
                        <div class="relative">
                            <div class="absolute top-2.5 left-3 flex items-center text-gray-500">
                                <label for="example12" class="block text-xs font-medium text-gray-700">Code</label>
                            </div>
                            <input type="text" id="example12" readonly="true"
                                class="block w-full pt-4 border-gray-300 rounded-md shadow-sm focus:border-primary-400 focus:ring focus:ring-primary-200 focus:ring-opacity-50 disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500"
                                [value]="selectedWorksheet?.empCd" />
                        </div>
                        <div class="relative">
                            <div class="absolute top-2.5 left-3 flex items-center text-gray-500">
                                <label for="example12"
                                    class="block text-xs font-medium text-gray-700">Department</label>
                            </div>
                            <input type="text" id="example12" readonly="true"
                                class="block w-full pt-4 border-gray-300 rounded-md shadow-sm focus:border-primary-400 focus:ring focus:ring-primary-200 focus:ring-opacity-50 disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500"
                                [value]="selectedWorksheet?.deptDs" />
                        </div>
                        <div class="relative">
                            <div class="absolute top-2.5 left-3 flex items-center text-gray-500">
                                <label for="example12" class="block text-xs font-medium text-gray-700">Date</label>
                            </div>
                            <input type="text" id="example12" readonly="true"
                                class="block w-full pt-4 border-gray-300 rounded-md shadow-sm focus:border-primary-400 focus:ring focus:ring-primary-200 focus:ring-opacity-50 disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500"
                                [value]="selectedWorksheet?.trnDate | date: 'dd/MM/yyyy'" />
                        </div>
                        <div class="w-full p-fluid" *ngIf="slideType == 0">
                            <label for="float-label" class="font-medium text-900">Leave Type</label>
                            <p-dropdown [options]="leaves" [checkmark]="true" optionLabel="leaveName" f
                                optionValue="leaveCd" [showClear]="false" placeholder="Select a Leave Type"
                                [(ngModel)]="selectedLeaveType" />
                        </div>
                        <div class="w-full p-fluid" *ngIf="slideType == 1">
                            <label for="float-label" class="font-medium text-900">Shift</label>
                            <p-dropdown [options]="shifts" [checkmark]="true" optionLabel="shiftCode" optionValue="code"
                                [showClear]="false" placeholder="Select a Shift" [(ngModel)]="selectedShift" />
                        </div>
                    </div>
                </div>
            </div>
        </ng-template>
        <ng-template pTemplate="footer">
            <div class="flex gap-2 justify-content-end">
                <p-button type="submit" label="Update" severity="primary" [outlined]="true"
                    [loading]="isSavingSlideData" icon="pi pi-check" class="ml-auto" (onClick)="onSubmitSlideData()"
                    [loading]="isSavingSlideData"></p-button>
                <p-button label="Cancel" severity="primary" [outlined]="true" text="true" icon="pi pi-times"
                    (onClick)="showChangeShiftPanel()"></p-button>
            </div>
        </ng-template>
    </p-sidebar>
</div>